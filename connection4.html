<!--
To use:
Open in two tabs:
//main3.html#{websocketID}

// Handle p2p connection for users sending data.

MAIN
setupWS, get nodeID once connected
Share node ID in QR code
When signal received, setupP2P, call signal

CONNEcTION
setupP2P, creates signal once connected, then
setupWS, once nodeID receive, then submit signal to main node ID



 -->

<!doctype html>
<html>
<head>
  <title>Repibox Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script type="text/javascript">
const _0xdc27=['https://betatasters.github.io/connection3#','reload','came\x20offline','body','answer','addEventListener','offer','destroy','innerHTML','split','<div><h1>YAYYYY</h1>YESSSS<h2></h2></div>','hash','#qrcodeCanvas','p2p\x20data\x20size:\x20','substr','signal\x20received:\x20','send','close','error','log','CONNECTED','onmessage','DOMContentLoaded','qrcode','data','location','Received\x20array\x20length:\x20','offline','compressToUTF16','focus','length','type','parse','online','wss://repibox.com/ws/','_fromid','stringify','came\x20online','compressToUint8Array','p2p\x20compressed\x20data\x20size:\x20'];(function(_0x29f584,_0x239dee){const _0xdc2768=function(_0xf66820){while(--_0xf66820){_0x29f584['push'](_0x29f584['shift']());}};_0xdc2768(++_0x239dee);}(_0xdc27,0x133));const _0xf668=function(_0x29f584,_0x239dee){_0x29f584=_0x29f584-0x172;let _0xdc2768=_0xdc27[_0x29f584];return _0xdc2768;};const _0x4d779c=_0xf668,isMain=location['hash'][_0x4d779c(0x175)]===0x0,hash=window[_0x4d779c(0x198)][_0x4d779c(0x18a)][_0x4d779c(0x18d)](0x1),hashArray=hash[_0x4d779c(0x188)]('_'),mainsId=hashArray[0x0];let connectionId='',nodeId=null;const ws=new WebSocket(_0x4d779c(0x179));let initialIDTransferFlag=!![],p2pSignal=null,p=null;function setupWS(){ws['onopen']=_0x3c8a87=>{const _0x4439ee=_0xf668;ws[_0x4439ee(0x194)]=_0x1c1908=>{const _0x14bb3e=_0x4439ee;let _0x2848c0=_0x1c1908[_0x14bb3e(0x197)];if(initialIDTransferFlag){nodeId=_0x2848c0;if(isMain)url=_0x14bb3e(0x17f)+nodeId,console[_0x14bb3e(0x192)](nodeId),console[_0x14bb3e(0x192)](url),jQuery(_0x14bb3e(0x18b))[_0x14bb3e(0x196)]({'text':url});else{console[_0x14bb3e(0x192)](p2pSignal);let _0xdbe369={...p2pSignal};_0xdbe369[_0x14bb3e(0x17a)]=nodeId,msgToSend=mainsId+','+LZString[_0x14bb3e(0x173)](JSON[_0x14bb3e(0x17b)](_0xdbe369)),ws['send'](msgToSend);}initialIDTransferFlag=![];}else{let _0xc8fb4f=LZString['decompressFromUTF16'](_0x2848c0);console[_0x14bb3e(0x192)](_0x14bb3e(0x18e)+_0xc8fb4f);const _0x468225=JSON[_0x14bb3e(0x177)](_0xc8fb4f);_0x468225[_0x14bb3e(0x17a)]&&(connectionId=_0x468225[_0x14bb3e(0x17a)],delete _0x468225[_0x14bb3e(0x17a)]),(isMain&&_0x468225['type']===_0x14bb3e(0x185)||!isMain&&_0x468225[_0x14bb3e(0x176)]===_0x14bb3e(0x183))&&p['signal'](_0x468225);}};};}function setupP2P(){const _0x128b15=_0x4d779c;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on']('signal',_0x1f9ae7=>{const _0x3ff5ae=_0xf668;p2pSignal=_0x1f9ae7;if(isMain){console['log']('SIGNAL',p2pSignal),console['log']('SIGNAL\x20length:',p2pSignal[_0x3ff5ae(0x175)]);let _0x336f3a=connectionId+','+LZString[_0x3ff5ae(0x173)](JSON[_0x3ff5ae(0x17b)](p2pSignal));ws[_0x3ff5ae(0x18f)](_0x336f3a);}else setupWS();}),p['on']('connect',()=>{const _0x3f6cc3=_0xf668;console[_0x3f6cc3(0x192)](_0x3f6cc3(0x193));if(isMain){let _0x5ad121=_0x3f6cc3(0x189);var _0x158765=LZString[_0x3f6cc3(0x17d)](_0x5ad121);console[_0x3f6cc3(0x192)](_0x3f6cc3(0x18c)+_0x5ad121[_0x3f6cc3(0x175)]),console[_0x3f6cc3(0x192)](_0x3f6cc3(0x17e)+_0x158765['length']),p[_0x3f6cc3(0x18f)](_0x158765),ws[_0x3f6cc3(0x190)]();}}),p['on'](_0x128b15(0x197),_0x119bb1=>{const _0x470881=_0x128b15;!isMain&&(console[_0x470881(0x192)](_0x470881(0x199)+_0x119bb1[_0x470881(0x175)]),document[_0x470881(0x182)][_0x470881(0x187)]=LZString['decompressFromUint8Array'](_0x119bb1),p[_0x470881(0x186)](),ws[_0x470881(0x190)]());}),p['on'](_0x128b15(0x190),()=>{const _0x38b5a5=_0x128b15;console['log']('CLOSED'),p['readable']&&p[_0x38b5a5(0x186)]();}),p['on'](_0x128b15(0x191),_0xd3d22c=>{const _0x58c7f1=_0x128b15;console[_0x58c7f1(0x192)](_0xd3d22c),p['readable']&&p[_0x58c7f1(0x186)]();});}setupP2P();isMain&&setupWS();window[_0x4d779c(0x184)](_0x4d779c(0x178),()=>console[_0x4d779c(0x192)](_0x4d779c(0x17c))),window['addEventListener'](_0x4d779c(0x172),()=>console[_0x4d779c(0x192)](_0x4d779c(0x181))),document[_0x4d779c(0x184)](_0x4d779c(0x195),async()=>{const _0x218455=_0x4d779c;isMain?document[_0x218455(0x182)][_0x218455(0x187)]='<div\x20id=\x27qrcodeCanvas\x27></div>':document['body']['innerHTML']='<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div></div>';}),$(window)[_0x4d779c(0x174)](function(){const _0x25cfa1=_0x4d779c;hash!==window[_0x25cfa1(0x198)]['hash'][_0x25cfa1(0x18d)](0x1)&&location[_0x25cfa1(0x180)]();});

  </script>

  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
