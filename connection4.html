<!--
To use:
Open in two tabs:
//main3.html#{websocketID}

// Handle p2p connection for users sending data.

MAIN
setupWS, get nodeID once connected
Share node ID in QR code
When signal received, setupP2P, call signal

CONNEcTION
setupP2P, creates signal once connected, then
setupWS, once nodeID receive, then submit signal to main node ID



 -->

<!doctype html>
<html>
<head>
  <title>Repibox Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script type="text/javascript">
const _0x3432=['came\x20online','<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div></div>','https://betatasters.github.io/connection3#','decompressFromUint8Array','compressToUint8Array','Received\x20array\x20length:\x20','location','#qrcodeCanvas','connect','<div\x20id=\x27qrcodeCanvas\x27></div>','stringify','parse','onopen','readable','SIGNAL','_fromid','log','body','hash','offline','length','data','reload','p2p\x20compressed\x20data\x20size:\x20','<div><h1>YAYYYY</h1>YESSSS<h2></h2></div>','qrcode','came\x20offline','destroy','SIGNAL\x20length:','substr','compressToUTF16','send','addEventListener','offer','p2p\x20data\x20size:\x20','signal\x20received:\x20','signal','innerHTML','error','answer','type','close','onmessage','CONNECTED','CLOSED','online'];(function(_0x19cb88,_0x2c1176){const _0x3432a8=function(_0x1616ff){while(--_0x1616ff){_0x19cb88['push'](_0x19cb88['shift']());}};_0x3432a8(++_0x2c1176);}(_0x3432,0x1c4));const _0x1616=function(_0x19cb88,_0x2c1176){_0x19cb88=_0x19cb88-0x1a9;let _0x3432a8=_0x3432[_0x19cb88];return _0x3432a8;};const _0x40f9ed=_0x1616,isMain=location[_0x40f9ed(0x1c3)][_0x40f9ed(0x1c5)]===0x0,hash=window['location'][_0x40f9ed(0x1c3)][_0x40f9ed(0x1ce)](0x1),hashArray=hash['split']('_'),mainsId=hashArray[0x0];let connectionId='',nodeId=null;const ws=new WebSocket('wss://repibox.com/ws/');let initialIDTransferFlag=!![],p2pSignal=null,p=null;function setupWS(){const _0x4c3f22=_0x40f9ed;ws[_0x4c3f22(0x1bd)]=_0x197923=>{const _0x4832d8=_0x4c3f22;ws[_0x4832d8(0x1ad)]=_0x421d46=>{const _0x53d60f=_0x4832d8;let _0x401a56=_0x421d46['data'];if(initialIDTransferFlag){nodeId=_0x401a56;if(isMain)url=_0x53d60f(0x1b3)+nodeId,console[_0x53d60f(0x1c1)](nodeId),console[_0x53d60f(0x1c1)](url),jQuery(_0x53d60f(0x1b8))[_0x53d60f(0x1ca)]({'text':url});else{console['log'](p2pSignal);let _0x261618={...p2pSignal};_0x261618[_0x53d60f(0x1c0)]=nodeId,msgToSend=mainsId+','+LZString['compressToUTF16'](JSON[_0x53d60f(0x1bb)](_0x261618)),ws[_0x53d60f(0x1d0)](msgToSend);}initialIDTransferFlag=![];}else{let _0xafc604=LZString['decompressFromUTF16'](_0x401a56);console[_0x53d60f(0x1c1)](_0x53d60f(0x1d4)+_0xafc604);const _0x2d5fad=JSON[_0x53d60f(0x1bc)](_0xafc604);_0x2d5fad[_0x53d60f(0x1c0)]&&(connectionId=_0x2d5fad[_0x53d60f(0x1c0)],delete _0x2d5fad[_0x53d60f(0x1c0)]),(isMain&&_0x2d5fad[_0x53d60f(0x1ab)]===_0x53d60f(0x1d2)||!isMain&&_0x2d5fad['type']===_0x53d60f(0x1aa))&&p['signal'](_0x2d5fad);}};};}function setupP2P(){const _0x2624f9=_0x40f9ed;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on'](_0x2624f9(0x1d5),_0x2a4cc7=>{const _0x48af0a=_0x2624f9;p2pSignal=_0x2a4cc7;if(isMain){console[_0x48af0a(0x1c1)](_0x48af0a(0x1bf),p2pSignal),console[_0x48af0a(0x1c1)](_0x48af0a(0x1cd),p2pSignal['length']);let _0x49e233=connectionId+','+LZString[_0x48af0a(0x1cf)](JSON[_0x48af0a(0x1bb)](p2pSignal));ws[_0x48af0a(0x1d0)](_0x49e233);}else setupWS();}),p['on'](_0x2624f9(0x1b9),()=>{const _0x28951c=_0x2624f9;console[_0x28951c(0x1c1)](_0x28951c(0x1ae));if(isMain){let _0x59a4b1=_0x28951c(0x1c9);var _0x13ac1e=LZString[_0x28951c(0x1b5)](_0x59a4b1);console[_0x28951c(0x1c1)](_0x28951c(0x1d3)+_0x59a4b1[_0x28951c(0x1c5)]),console['log'](_0x28951c(0x1c8)+_0x13ac1e[_0x28951c(0x1c5)]),p['send'](_0x13ac1e),ws[_0x28951c(0x1ac)]();}}),p['on'](_0x2624f9(0x1c6),_0x35b993=>{const _0x56cbab=_0x2624f9;!isMain&&(console[_0x56cbab(0x1c1)](_0x56cbab(0x1b6)+_0x35b993[_0x56cbab(0x1c5)]),document['body'][_0x56cbab(0x1d6)]=LZString[_0x56cbab(0x1b4)](_0x35b993),p[_0x56cbab(0x1cc)](),ws[_0x56cbab(0x1ac)]());}),p['on']('close',()=>{const _0x2c0b0c=_0x2624f9;console['log'](_0x2c0b0c(0x1af)),p[_0x2c0b0c(0x1be)]&&p[_0x2c0b0c(0x1cc)]();}),p['on'](_0x2624f9(0x1a9),_0x3c8358=>{const _0x3a181c=_0x2624f9;console[_0x3a181c(0x1c1)](_0x3c8358),p[_0x3a181c(0x1be)]&&p[_0x3a181c(0x1cc)]();});}window['addEventListener'](_0x40f9ed(0x1b0),()=>console[_0x40f9ed(0x1c1)](_0x40f9ed(0x1b1))),window[_0x40f9ed(0x1d1)](_0x40f9ed(0x1c4),()=>console['log'](_0x40f9ed(0x1cb))),document[_0x40f9ed(0x1d1)]('DOMContentLoaded',async()=>{const _0x5de6a3=_0x40f9ed;setupP2P(),isMain&&setupWS(),isMain?document[_0x5de6a3(0x1c2)]['innerHTML']=_0x5de6a3(0x1ba):document['body'][_0x5de6a3(0x1d6)]=_0x5de6a3(0x1b2);}),$(window)['focus'](function(){const _0x1e06f9=_0x40f9ed;hash!==window[_0x1e06f9(0x1b7)][_0x1e06f9(0x1c3)]['substr'](0x1)&&location[_0x1e06f9(0x1c7)]();});
   
  </script>

  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
