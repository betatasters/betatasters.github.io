<!--
To use:
Open in two tabs:
file:///Users/bri/Desktop/main2.html#Qmau6v6iBDXTTh3MZDTxXZuGzHDnfw9DDTdYVbVZRd2Js9+123
file:///Users/bri/Desktop/main2.html#{IPFS_ID}+{TAB_ID}
 -->

<!doctype html>
<html>
<head>
  <title>IPFS in the Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1"> -->
  <!-- <meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”> -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
  <script type="text/javascript">
  const _0x4acf=['recipe-pubsub-test','signal','log','data','compressToUint8Array','publish','destroy','encode','reload','hash','addEventListener','type','innerText','<div\x20id=\x27qrcodeCanvas\x27></div>','addrs','ipfs-','style','error','close','node','pubsub','/p2p/','random','DOMContentLoaded','offer','p2p\x20data\x20size:\x20','/p2p-circuit/p2p/','SIGNAL','innerHTML','createElement','Received\x20array\x20length:\x20','online','qrcode','decompressFromUTF16','tabid','length','CLOSED','create','readable','stop','</h2></div>','<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div><div>Connecting\x20to\x20IPFS\x20Nodes:</div></div>','getElementById','decompressFromUint8Array','swarm','signal\x20received:\x20','subscribe','compressToUTF16','padding-left:\x2010px;','SIGNAL\x20length:','came\x20online','_tabid','topic\x20is\x20','loading','appendChild','<div><h1>YAYYYY</h1>YESSSS<h2>Tab\x20id\x20','substr','body'];(function(_0x1fb2d2,_0x4acfaa){const _0x33f5f2=function(_0x400711){while(--_0x400711){_0x1fb2d2['push'](_0x1fb2d2['shift']());}};_0x33f5f2(++_0x4acfaa);}(_0x4acf,0x72));const _0x33f5=function(_0x1fb2d2,_0x4acfaa){_0x1fb2d2=_0x1fb2d2-0x0;let _0x33f5f2=_0x4acf[_0x1fb2d2];return _0x33f5f2;};const _0x5db36d=_0x33f5;let topic=_0x5db36d('0x2');const delay=_0x400711=>new Promise(_0xd70420=>setTimeout(_0xd70420,_0x400711));let node=null;const isMain=location[_0x5db36d('0xb')][_0x5db36d('0x25')]===0x0,hash=window['location'][_0x5db36d('0xb')][_0x5db36d('0x0')](0x1),hashArray=hash['split']('+'),mainsId=hashArray[0x0];let tabId=hashArray[0x1]?hashArray[0x1]:'';!isMain&&(topic=topic+mainsId,console[_0x5db36d('0x4')]('topic\x20is\x20'+topic));let p2pSignal=null,p=null;function setupP2P(){const _0x3d12b9=_0x5db36d;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on'](_0x3d12b9('0x3'),_0x578d3d=>{const _0x24894a=_0x3d12b9;let _0x36fc91={..._0x578d3d};!isMain&&tabId&&(_0x36fc91[_0x24894a('0x24')]=tabId);str=JSON['stringify'](_0x36fc91),console[_0x24894a('0x4')](_0x24894a('0x1d'),str),console[_0x24894a('0x4')](_0x24894a('0x33'),str[_0x24894a('0x25')]);var _0x91f766=LZString[_0x24894a('0x31')](str);p2pSignal=new TextEncoder()[_0x24894a('0x9')](_0x91f766),isMain&&(console['log'](_0x24894a('0x36')+topic),node[_0x24894a('0x16')]['publish'](topic,p2pSignal));}),p['on']('connect',()=>{const _0x155ebd=_0x3d12b9;console['log']('CONNECTED');if(isMain){let _0x1da496=_0x155ebd('0x39')+tabId+_0x155ebd('0x2a');var _0x22cf80=LZString[_0x155ebd('0x6')](_0x1da496);console[_0x155ebd('0x4')](_0x155ebd('0x1b')+_0x1da496[_0x155ebd('0x25')]),console[_0x155ebd('0x4')]('p2p\x20compressed\x20data\x20size:\x20'+_0x22cf80[_0x155ebd('0x25')]),p['send'](_0x22cf80);}}),p['on'](_0x3d12b9('0x5'),_0x38ecd1=>{const _0x2d04f5=_0x3d12b9;!isMain&&(console[_0x2d04f5('0x4')](_0x2d04f5('0x20')+_0x38ecd1[_0x2d04f5('0x25')]),document[_0x2d04f5('0x1')][_0x2d04f5('0x1e')]=LZString[_0x2d04f5('0x2d')](_0x38ecd1),node[_0x2d04f5('0x29')](),p[_0x2d04f5('0x8')]()),p[_0x2d04f5('0x28')]&&p[_0x2d04f5('0x8')](),isMain&&setupP2P();}),p['on'](_0x3d12b9('0x14'),()=>{const _0x33b16b=_0x3d12b9;console[_0x33b16b('0x4')](_0x33b16b('0x26')),p[_0x33b16b('0x28')]&&p['destroy'](),isMain&&setupP2P();}),p['on'](_0x3d12b9('0x13'),_0x3caf5f=>{const _0x36178f=_0x3d12b9;console[_0x36178f('0x4')](_0x3caf5f),p[_0x36178f('0x28')]&&p['destroy'](),isMain&&setupP2P();});}setupP2P(),window['addEventListener'](_0x5db36d('0x21'),()=>console[_0x5db36d('0x4')](_0x5db36d('0x34'))),window[_0x5db36d('0xc')]('offline',()=>console[_0x5db36d('0x4')]('came\x20offline')),document['addEventListener'](_0x5db36d('0x19'),async()=>{const _0x5cf5b0=_0x5db36d;isMain?document[_0x5cf5b0('0x1')][_0x5cf5b0('0x1e')]=_0x5cf5b0('0xf'):document[_0x5cf5b0('0x1')]['innerHTML']=_0x5cf5b0('0x2b');node=window[_0x5cf5b0('0x15')]=await Ipfs[_0x5cf5b0('0x27')]({'repo':_0x5cf5b0('0x11')+Math[_0x5cf5b0('0x18')](),'relay':{'enabled':!![],'hop':{'enabled':!![],'active':!![]}}}),nodeId=(await node['id']())['id'];isMain&&(topic=topic+nodeId);console[_0x5cf5b0('0x4')]('node\x20id\x20'+nodeId);isMain&&(url='https://betatasters.github.io/connection3#'+nodeId,console[_0x5cf5b0('0x4')](url),jQuery('#qrcodeCanvas')[_0x5cf5b0('0x22')]({'text':url}));await node[_0x5cf5b0('0x16')][_0x5cf5b0('0x30')](topic,({from:_0x44da38,data:_0xf51d8c,topicIDs:_0x3eab49,seqno:_0x548047})=>{const _0x3b6387=_0x5cf5b0;if(_0x44da38!==nodeId){let _0x5933ee=new TextDecoder()['decode'](_0xf51d8c);_0x5933ee=LZString[_0x3b6387('0x23')](_0x5933ee),console[_0x3b6387('0x4')](_0x3b6387('0x2f')+_0x5933ee);const _0x1dd94e=JSON['parse'](_0x5933ee);_0x1dd94e[_0x3b6387('0x35')]&&(tabId=_0x1dd94e['_tabid'],delete _0x1dd94e[_0x3b6387('0x35')]),(isMain&&_0x1dd94e['type']===_0x3b6387('0x1a')||!isMain&&_0x1dd94e[_0x3b6387('0xd')]==='answer')&&p[_0x3b6387('0x3')](_0x1dd94e);}});if(!isMain){for(const _0x72f3fb of await node[_0x5cf5b0('0x2e')][_0x5cf5b0('0x10')]()){if(_0x72f3fb['id']===mainsId)continue;try{const _0x2d44b2=_0x5cf5b0('0x17')+_0x72f3fb['id']+_0x5cf5b0('0x1c')+mainsId;var _0x408f9d=document[_0x5cf5b0('0x1f')]('div');_0x408f9d[_0x5cf5b0('0xe')]=_0x72f3fb['id'],_0x408f9d[_0x5cf5b0('0x12')]=_0x5cf5b0('0x32'),document[_0x5cf5b0('0x2c')](_0x5cf5b0('0x37'))[_0x5cf5b0('0x38')](_0x408f9d),await node[_0x5cf5b0('0x2e')]['connect'](_0x2d44b2);}catch(_0xec70ba){console[_0x5cf5b0('0x4')](_0xec70ba);}}await delay(0x3e8),p2pSignal?await node[_0x5cf5b0('0x16')][_0x5cf5b0('0x7')](topic,p2pSignal):(await delay(0x7d0),p2pSignal&&await node[_0x5cf5b0('0x16')][_0x5cf5b0('0x7')](topic,p2pSignal));}}),$(window)['focus'](function(){const _0x54339d=_0x5db36d;hash!==window['location'][_0x54339d('0xb')][_0x54339d('0x0')](0x1)&&location[_0x54339d('0xa')]();});
   
  </script>

  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
