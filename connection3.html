<!--
To use:
Open in two tabs:
file:///Users/bri/Desktop/main2.html#Qmau6v6iBDXTTh3MZDTxXZuGzHDnfw9DDTdYVbVZRd2Js9+123
file:///Users/bri/Desktop/main2.html#{IPFS_ID}+{TAB_ID}
 -->

<!doctype html>
<html>
<head>
  <title>IPFS in the Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1"> -->
  <!-- <meta http-equiv=“CACHE-CONTROL” content=”NO-CACHE”> -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
  <script type="text/javascript">
const _0x2f1f=['style','#qrcodeCanvas','innerText','p2p\x20compressed\x20data\x20size:\x20','readable','innerHTML','node','random','signal','offer','stringify','topic\x20is\x20','/p2p/','node\x20id\x20','length','focus','recipe-pubsub-test','signal\x20received:\x20','addrs','padding-left:\x2010px;','create','/p2p-circuit/p2p/','publish','CONNECTED','connect','ipfs-','hash','online','subscribe','p2p\x20data\x20size:\x20','qrcode','data','_tabid','body','log','type','tabid','substr','destroy','send','Received\x20array\x20length:\x20','addEventListener','pubsub','came\x20offline','offline','div','decompressFromUTF16','location','split','swarm','DOMContentLoaded','createElement','<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div><div>Connecting\x20to\x20IPFS\x20Nodes:</div></div>','SIGNAL'];(function(_0x1376ce,_0x2f1fb9){const _0x41f1c1=function(_0x384ee3){while(--_0x384ee3){_0x1376ce['push'](_0x1376ce['shift']());}};_0x41f1c1(++_0x2f1fb9);}(_0x2f1f,0x17d));const _0x41f1=function(_0x1376ce,_0x2f1fb9){_0x1376ce=_0x1376ce-0x0;let _0x41f1c1=_0x2f1f[_0x1376ce];return _0x41f1c1;};const _0x98db3b=_0x41f1;let topic=_0x98db3b('0xd');const delay=_0x384ee3=>new Promise(_0x55fab8=>setTimeout(_0x55fab8,_0x384ee3));let node=null;const isMain=location[_0x98db3b('0x17')][_0x98db3b('0xb')]===0x0,hash=window['location'][_0x98db3b('0x17')][_0x98db3b('0x22')](0x1),hashArray=hash[_0x98db3b('0x2d')]('+'),mainsId=hashArray[0x0];let tabId=hashArray[0x1]?hashArray[0x1]:'';!isMain&&(topic=topic+mainsId,console['log'](_0x98db3b('0x8')+topic));let p2pSignal=null,p=null;function setupP2P(){const _0x259d94=_0x98db3b;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on'](_0x259d94('0x5'),_0x854a71=>{const _0x56c7b2=_0x259d94;let _0x13fae1={..._0x854a71};!isMain&&tabId&&(_0x13fae1[_0x56c7b2('0x21')]=tabId);str=JSON[_0x56c7b2('0x7')](_0x13fae1),console['log'](_0x56c7b2('0x32'),str),console[_0x56c7b2('0x1f')]('SIGNAL\x20length:',str[_0x56c7b2('0xb')]);var _0x39f09c=LZString['compressToUTF16'](str);p2pSignal=new TextEncoder()['encode'](_0x39f09c),isMain&&(console[_0x56c7b2('0x1f')]('topic\x20is\x20'+topic),node[_0x56c7b2('0x27')]['publish'](topic,p2pSignal));}),p['on'](_0x259d94('0x15'),()=>{const _0x267fc7=_0x259d94;console[_0x267fc7('0x1f')](_0x267fc7('0x14'));if(isMain){let _0xe3aa69='<div><h1>YAYYYY</h1>YESSSS<h2>Tab\x20id\x20'+tabId+'</h2></div>';var _0x16284c=LZString['compressToUint8Array'](_0xe3aa69);console['log'](_0x267fc7('0x1a')+_0xe3aa69[_0x267fc7('0xb')]),console[_0x267fc7('0x1f')](_0x267fc7('0x0')+_0x16284c[_0x267fc7('0xb')]),p[_0x267fc7('0x24')](_0x16284c);}}),p['on'](_0x259d94('0x1c'),_0x2b9ea9=>{const _0x49d96f=_0x259d94;!isMain&&(console[_0x49d96f('0x1f')](_0x49d96f('0x25')+_0x2b9ea9[_0x49d96f('0xb')]),document['body'][_0x49d96f('0x2')]=LZString['decompressFromUint8Array'](_0x2b9ea9),p[_0x49d96f('0x23')](),async function(){await node['stop']();}()),p[_0x49d96f('0x1')]&&p['destroy'](),isMain&&setupP2P();}),p['on']('close',()=>{const _0x46685c=_0x259d94;console[_0x46685c('0x1f')]('CLOSED'),p['readable']&&p['destroy'](),isMain&&setupP2P();}),p['on']('error',_0x1598c1=>{const _0x43cbef=_0x259d94;console[_0x43cbef('0x1f')](_0x1598c1),p[_0x43cbef('0x1')]&&p['destroy'](),isMain&&setupP2P();});}setupP2P(),window[_0x98db3b('0x26')](_0x98db3b('0x18'),()=>console[_0x98db3b('0x1f')]('came\x20online')),window[_0x98db3b('0x26')](_0x98db3b('0x29'),()=>console[_0x98db3b('0x1f')](_0x98db3b('0x28'))),document[_0x98db3b('0x26')](_0x98db3b('0x2f'),async()=>{const _0x57a6d2=_0x98db3b;isMain?document[_0x57a6d2('0x1e')]['innerHTML']='<div\x20id=\x27qrcodeCanvas\x27></div>':document[_0x57a6d2('0x1e')][_0x57a6d2('0x2')]=_0x57a6d2('0x31');node=window[_0x57a6d2('0x3')]=await Ipfs[_0x57a6d2('0x11')]({'repo':_0x57a6d2('0x16')+Math[_0x57a6d2('0x4')](),'relay':{'enabled':!![],'hop':{'enabled':!![],'active':!![]}}}),nodeId=(await node['id']())['id'];isMain&&(topic=topic+nodeId);console[_0x57a6d2('0x1f')](_0x57a6d2('0xa')+nodeId);isMain&&(url='https://betatasters.github.io/connection3#'+nodeId,console[_0x57a6d2('0x1f')](url),jQuery(_0x57a6d2('0x34'))[_0x57a6d2('0x1b')]({'text':url}));await node[_0x57a6d2('0x27')][_0x57a6d2('0x19')](topic,({from:_0x39a228,data:_0x568a93,topicIDs:_0x5187ee,seqno:_0x4335c6})=>{const _0x43d7bf=_0x57a6d2;if(_0x39a228!==nodeId){let _0xc651be=new TextDecoder()['decode'](_0x568a93);_0xc651be=LZString[_0x43d7bf('0x2b')](_0xc651be),console[_0x43d7bf('0x1f')](_0x43d7bf('0xe')+_0xc651be);const _0x2127fd=JSON['parse'](_0xc651be);_0x2127fd[_0x43d7bf('0x1d')]&&(tabId=_0x2127fd[_0x43d7bf('0x1d')],delete _0x2127fd[_0x43d7bf('0x1d')]),(isMain&&_0x2127fd[_0x43d7bf('0x20')]===_0x43d7bf('0x6')||!isMain&&_0x2127fd[_0x43d7bf('0x20')]==='answer')&&p[_0x43d7bf('0x5')](_0x2127fd);}});if(!isMain){for(const _0x27d4b9 of await node[_0x57a6d2('0x2e')][_0x57a6d2('0xf')]()){if(_0x27d4b9['id']===mainsId)continue;try{const _0xf32815=_0x57a6d2('0x9')+_0x27d4b9['id']+_0x57a6d2('0x12')+mainsId;var _0x339ab6=document[_0x57a6d2('0x30')](_0x57a6d2('0x2a'));_0x339ab6[_0x57a6d2('0x35')]=_0x27d4b9['id'],_0x339ab6[_0x57a6d2('0x33')]=_0x57a6d2('0x10'),document['getElementById']('loading')['appendChild'](_0x339ab6),await node[_0x57a6d2('0x2e')]['connect'](_0xf32815);}catch(_0x3240ea){console[_0x57a6d2('0x1f')](_0x3240ea);}}await delay(0x3e8),p2pSignal?await node[_0x57a6d2('0x27')][_0x57a6d2('0x13')](topic,p2pSignal):(await delay(0x7d0),p2pSignal&&await node[_0x57a6d2('0x27')][_0x57a6d2('0x13')](topic,p2pSignal));}}),$(window)[_0x98db3b('0xc')](function(){const _0x2d2af3=_0x98db3b;hash!==window[_0x2d2af3('0x2c')][_0x2d2af3('0x17')]['substr'](0x1)&&location['reload']();});
   
  </script>

  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
