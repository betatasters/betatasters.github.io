<!--
To use:
Open in two tabs:
file:///Users/bri/Desktop/main2.html#Qmau6v6iBDXTTh3MZDTxXZuGzHDnfw9DDTdYVbVZRd2Js9+123
file:///Users/bri/Desktop/main2.html#{IPFS_ID}+{TAB_ID}
 -->

<!doctype html>
<html>
<head>
  <title>IPFS in the Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
  <script type="text/javascript">
 
   const _0x82f1=['innerHTML','publish','offline','compressToUint8Array','ipfs-','hash','send','/p2p/','getElementById','body','/p2p-circuit/p2p/','connect','destroy','came\x20online','node\x20id\x20','addEventListener','compressToUTF16','signal','substr','SIGNAL','answer','type','<div><h1>YAYYYY</h1>YESSSS<h2>Tab\x20id\x20','node','decode','pubsub','Received\x20array\x20length:\x20','recipe-pubsub-test','div','#qrcodeCanvas','<div\x20id=\x27qrcodeCanvas\x27></div>','error','subscribe','https://betatasters.github.io/connection3#','signal\x20received:\x20','random','location','swarm','qrcode','padding-left:\x2010px;','_tabid','encode','</h2></div>','parse','online','decompressFromUint8Array','stringify','innerText','create','p2p\x20data\x20size:\x20','addrs','style','CONNECTED','log','loading','topic\x20is\x20','offer','readable','came\x20offline','length'];(function(_0x4eb29b,_0x82f111){const _0x46c4a8=function(_0x507ff2){while(--_0x507ff2){_0x4eb29b['push'](_0x4eb29b['shift']());}};_0x46c4a8(++_0x82f111);}(_0x82f1,0x12b));const _0x46c4=function(_0x4eb29b,_0x82f111){_0x4eb29b=_0x4eb29b-0x0;let _0x46c4a8=_0x82f1[_0x4eb29b];return _0x46c4a8;};const _0x210bc1=_0x46c4;let topic=_0x210bc1('0x1c');const delay=_0x507ff2=>new Promise(_0x5aaa94=>setTimeout(_0x5aaa94,_0x507ff2)),isMain=location[_0x210bc1('0x6')][_0x210bc1('0x0')]===0x0,hash=window[_0x210bc1('0x25')][_0x210bc1('0x6')][_0x210bc1('0x13')](0x1),hashArray=hash['split']('+'),mainsId=hashArray[0x0];let tabId=hashArray[0x1]?hashArray[0x1]:'';!isMain&&(topic=topic+mainsId,console['log']('topic\x20is\x20'+topic));let p2pSignal=null,p=null;function setupP2P(){const _0x55c158=_0x210bc1;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on'](_0x55c158('0x12'),_0x2d029c=>{const _0x46a012=_0x55c158;let _0x2e9157={..._0x2d029c};!isMain&&tabId&&(_0x2e9157['_tabid']=tabId);str=JSON[_0x46a012('0x2f')](_0x2e9157),console[_0x46a012('0x36')](_0x46a012('0x14'),str),console[_0x46a012('0x36')]('SIGNAL\x20length:',str[_0x46a012('0x0')]);var _0x3bab3b=LZString[_0x46a012('0x11')](str);p2pSignal=new TextEncoder()[_0x46a012('0x2a')](_0x3bab3b),isMain&&(console[_0x46a012('0x36')](_0x46a012('0x38')+topic),node['pubsub'][_0x46a012('0x2')](topic,p2pSignal));}),p['on'](_0x55c158('0xc'),()=>{const _0x95916c=_0x55c158;console['log'](_0x95916c('0x35'));if(isMain){let _0x3391d4=_0x95916c('0x17')+tabId+_0x95916c('0x2b');var _0x415c16=LZString[_0x95916c('0x4')](_0x3391d4);console['log'](_0x95916c('0x32')+_0x3391d4[_0x95916c('0x0')]),console[_0x95916c('0x36')]('p2p\x20compressed\x20data\x20size:\x20'+_0x415c16[_0x95916c('0x0')]),p[_0x95916c('0x7')](_0x415c16);}}),p['on']('data',_0xb030fa=>{const _0x288bb6=_0x55c158;!isMain&&(console['log'](_0x288bb6('0x1b')+_0xb030fa[_0x288bb6('0x0')]),document['body'][_0x288bb6('0x1')]=LZString[_0x288bb6('0x2e')](_0xb030fa)),p[_0x288bb6('0x3a')]&&p[_0x288bb6('0xd')](),isMain&&setupP2P();}),p['on']('close',()=>{const _0x27ebb6=_0x55c158;console[_0x27ebb6('0x36')]('CLOSED'),p[_0x27ebb6('0x3a')]&&p['destroy'](),isMain&&setupP2P();}),p['on'](_0x55c158('0x20'),_0x12f16d=>{const _0x2e85e4=_0x55c158;console[_0x2e85e4('0x36')](_0x12f16d),p[_0x2e85e4('0x3a')]&&p[_0x2e85e4('0xd')](),isMain&&setupP2P();});}setupP2P(),window[_0x210bc1('0x10')](_0x210bc1('0x2d'),()=>console[_0x210bc1('0x36')](_0x210bc1('0xe'))),window[_0x210bc1('0x10')](_0x210bc1('0x3'),()=>console['log'](_0x210bc1('0x3b'))),document[_0x210bc1('0x10')]('DOMContentLoaded',async()=>{const _0x154edd=_0x210bc1;isMain?document[_0x154edd('0xa')][_0x154edd('0x1')]=_0x154edd('0x1f'):document[_0x154edd('0xa')]['innerHTML']='<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div><div>Connecting\x20to\x20IPFS\x20Nodes:</div></div>';const _0x51ed4b=window[_0x154edd('0x18')]=await Ipfs[_0x154edd('0x31')]({'repo':_0x154edd('0x5')+Math[_0x154edd('0x24')](),'relay':{'enabled':!![],'hop':{'enabled':!![],'active':!![]}}});nodeId=(await _0x51ed4b['id']())['id'];isMain&&(topic=topic+nodeId);console['log'](_0x154edd('0xf')+nodeId);isMain&&(url=_0x154edd('0x22')+nodeId,console['log'](url),jQuery(_0x154edd('0x1e'))[_0x154edd('0x27')]({'text':url}));await _0x51ed4b[_0x154edd('0x1a')][_0x154edd('0x21')](topic,({from:_0x26aa2c,data:_0x89777e,topicIDs:_0x1dfba0,seqno:_0x1fbb55})=>{const _0x1b3656=_0x154edd;if(_0x26aa2c!==nodeId){let _0x575573=new TextDecoder()[_0x1b3656('0x19')](_0x89777e);_0x575573=LZString['decompressFromUTF16'](_0x575573),console[_0x1b3656('0x36')](_0x1b3656('0x23')+_0x575573);const _0x3a0311=JSON[_0x1b3656('0x2c')](_0x575573);_0x3a0311[_0x1b3656('0x29')]&&(tabId=_0x3a0311[_0x1b3656('0x29')],delete _0x3a0311['_tabid']),(isMain&&_0x3a0311[_0x1b3656('0x16')]===_0x1b3656('0x39')||!isMain&&_0x3a0311[_0x1b3656('0x16')]===_0x1b3656('0x15'))&&p[_0x1b3656('0x12')](_0x3a0311);}});if(!isMain){for(const _0x44942b of await _0x51ed4b[_0x154edd('0x26')][_0x154edd('0x33')]()){if(_0x44942b['id']===mainsId)continue;try{const _0x2d1d60=_0x154edd('0x8')+_0x44942b['id']+_0x154edd('0xb')+mainsId;var _0x1a5c27=document['createElement'](_0x154edd('0x1d'));_0x1a5c27[_0x154edd('0x30')]=_0x44942b['id'],_0x1a5c27[_0x154edd('0x34')]=_0x154edd('0x28'),document[_0x154edd('0x9')](_0x154edd('0x37'))['appendChild'](_0x1a5c27),await _0x51ed4b[_0x154edd('0x26')]['connect'](_0x2d1d60);}catch(_0x3c7069){console[_0x154edd('0x36')](_0x3c7069);}}await delay(0x3e8),p2pSignal?await _0x51ed4b['pubsub'][_0x154edd('0x2')](topic,p2pSignal):(await delay(0x7d0),p2pSignal&&await _0x51ed4b[_0x154edd('0x1a')]['publish'](topic,p2pSignal));}});
   
  </script>

  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
