<!--
To use:
Open in two tabs:
file:///Users/bri/Desktop/main2.html#Qmau6v6iBDXTTh3MZDTxXZuGzHDnfw9DDTdYVbVZRd2Js9+123
file:///Users/bri/Desktop/main2.html#{IPFS_ID}+{TAB_ID}
 -->

<!doctype html>
<html>
<head>
  <title>IPFS in the Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/9.8.0/simplepeer.min.js" integrity="sha512-E7n4M9VAeElTbAvxzEO92tYsjfg1e0INE+RQLEf3Dpra2EY2X2ygTaGi2NMpccKGY8Q7+npUX68igKUkAammKQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous"></script>


  <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
  <script type="text/javascript">
  
  </script>
const _0x54f5=['offline','log','SIGNAL','readable','decode','publish','node','hash','offer','div','addEventListener','_tabid','answer','stringify','createElement','SIGNAL\x20length:','recipe-pubsub-test','split','encode','pubsub','connect','random','addrs','data','https://betatasters.github.io/connection3#','substr','DOMContentLoaded','<div><h1>YAYYYY</h1>YESSSS<h2>Tab\x20id\x20','topic\x20is\x20','body','p2p\x20compressed\x20data\x20size:\x20','<div\x20id=\x27loading\x27>Loading\x20Recipe<div\x20class=\x27loader\x27></div><div>Connecting\x20to\x20IPFS\x20Nodes:</div></div>','swarm','qrcode','compressToUint8Array','location','signal\x20received:\x20','CONNECTED','came\x20online','<div\x20id=\x27qrcodeCanvas\x27></div>','signal','/p2p-circuit/p2p/','</h2></div>','CLOSED','padding-left:\x2010px;','innerHTML','length','style','ipfs-','loading','close','decompressFromUTF16','#qrcodeCanvas','innerText','destroy','error','online'];(function(_0x4cea1f,_0x54f5ad){const _0x20d73a=function(_0x524cdc){while(--_0x524cdc){_0x4cea1f['push'](_0x4cea1f['shift']());}};_0x20d73a(++_0x54f5ad);}(_0x54f5,0x1d9));const _0x20d7=function(_0x4cea1f,_0x54f5ad){_0x4cea1f=_0x4cea1f-0x0;let _0x20d73a=_0x54f5[_0x4cea1f];return _0x20d73a;};const _0x335932=_0x20d7;let topic=_0x335932('0x38');const delay=_0x524cdc=>new Promise(_0x4ddafb=>setTimeout(_0x4ddafb,_0x524cdc)),isMain=location[_0x335932('0x2f')][_0x335932('0x1d')]===0x0,hash=window[_0x335932('0x12')][_0x335932('0x2f')][_0x335932('0x8')](0x1),hashArray=hash[_0x335932('0x0')]('+'),mainsId=hashArray[0x0];let tabId=hashArray[0x1]?hashArray[0x1]:'';!isMain&&(topic=topic+mainsId,console[_0x335932('0x29')](_0x335932('0xb')+topic));let p2pSignal=null,p=null;function setupP2P(){const _0x3b83b9=_0x335932;p=new SimplePeer({'initiator':!isMain,'trickle':![]}),p['on']('signal',_0x57028d=>{const _0x170f31=_0x20d7;let _0x4c865b={..._0x57028d};!isMain&&tabId&&(_0x4c865b[_0x170f31('0x33')]=tabId);str=JSON[_0x170f31('0x35')](_0x4c865b),console['log'](_0x170f31('0x2a'),str),console[_0x170f31('0x29')](_0x170f31('0x37'),str[_0x170f31('0x1d')]);var _0x2b2d6e=LZString['compressToUTF16'](str);p2pSignal=new TextEncoder()[_0x170f31('0x1')](_0x2b2d6e),isMain&&(console[_0x170f31('0x29')]('topic\x20is\x20'+topic),node[_0x170f31('0x2')][_0x170f31('0x2d')](topic,p2pSignal));}),p['on'](_0x3b83b9('0x3'),()=>{const _0xf9e0a7=_0x3b83b9;console[_0xf9e0a7('0x29')](_0xf9e0a7('0x14'));if(isMain){let _0x4afc02=_0xf9e0a7('0xa')+tabId+_0xf9e0a7('0x19');var _0x129bb6=LZString[_0xf9e0a7('0x11')](_0x4afc02);console[_0xf9e0a7('0x29')]('p2p\x20data\x20size:\x20'+_0x4afc02['length']),console[_0xf9e0a7('0x29')](_0xf9e0a7('0xd')+_0x129bb6[_0xf9e0a7('0x1d')]),p['send'](_0x129bb6);}}),p['on'](_0x3b83b9('0x6'),_0x3d34d2=>{const _0x15a93b=_0x3b83b9;!isMain&&(console[_0x15a93b('0x29')]('Received\x20array\x20length:\x20'+_0x3d34d2['length']),document['body'][_0x15a93b('0x1c')]=LZString['decompressFromUint8Array'](_0x3d34d2)),p[_0x15a93b('0x2b')]&&p[_0x15a93b('0x25')](),isMain&&setupP2P();}),p['on'](_0x3b83b9('0x21'),()=>{const _0x596d11=_0x3b83b9;console[_0x596d11('0x29')](_0x596d11('0x1a')),p['readable']&&p[_0x596d11('0x25')](),isMain&&setupP2P();}),p['on'](_0x3b83b9('0x26'),_0xa09ac9=>{const _0x33062a=_0x3b83b9;console[_0x33062a('0x29')](_0xa09ac9),p[_0x33062a('0x2b')]&&p[_0x33062a('0x25')](),isMain&&setupP2P();});}setupP2P(),window[_0x335932('0x32')](_0x335932('0x27'),()=>console[_0x335932('0x29')](_0x335932('0x15'))),window[_0x335932('0x32')](_0x335932('0x28'),()=>console[_0x335932('0x29')]('came\x20offline')),document[_0x335932('0x32')](_0x335932('0x9'),async()=>{const _0x478cd2=_0x335932;isMain?document[_0x478cd2('0xc')]['innerHTML']=_0x478cd2('0x16'):document[_0x478cd2('0xc')][_0x478cd2('0x1c')]=_0x478cd2('0xe');const _0x44586c=window[_0x478cd2('0x2e')]=await Ipfs['create']({'repo':_0x478cd2('0x1f')+Math[_0x478cd2('0x4')](),'relay':{'enabled':!![],'hop':{'enabled':!![],'active':!![]}}});nodeId=(await _0x44586c['id']())['id'];isMain&&(topic=topic+nodeId);console[_0x478cd2('0x29')]('node\x20id\x20'+nodeId);isMain&&(url=_0x478cd2('0x7')+nodeId,console['log'](url),jQuery(_0x478cd2('0x23'))[_0x478cd2('0x10')]({'text':url}));await _0x44586c['pubsub']['subscribe'](topic,({from:_0x240bf2,data:_0x4f61ea,topicIDs:_0x2ac32b,seqno:_0x4adba2})=>{const _0x4b2d6e=_0x478cd2;if(_0x240bf2!==nodeId){let _0x3ef99e=new TextDecoder()[_0x4b2d6e('0x2c')](_0x4f61ea);_0x3ef99e=LZString[_0x4b2d6e('0x22')](_0x3ef99e),console[_0x4b2d6e('0x29')](_0x4b2d6e('0x13')+_0x3ef99e);const _0xddf34e=JSON['parse'](_0x3ef99e);_0xddf34e['_tabid']&&(tabId=_0xddf34e[_0x4b2d6e('0x33')],delete _0xddf34e['_tabid']),(isMain&&_0xddf34e['type']===_0x4b2d6e('0x30')||!isMain&&_0xddf34e['type']===_0x4b2d6e('0x34'))&&p[_0x4b2d6e('0x17')](_0xddf34e);}});if(!isMain){for(const _0x52ae06 of await _0x44586c[_0x478cd2('0xf')][_0x478cd2('0x5')]()){if(_0x52ae06['id']===mainsId)continue;try{const _0xd6d02f='/p2p/'+_0x52ae06['id']+_0x478cd2('0x18')+mainsId;var _0x4925e0=document[_0x478cd2('0x36')](_0x478cd2('0x31'));_0x4925e0[_0x478cd2('0x24')]=_0x52ae06['id'],_0x4925e0[_0x478cd2('0x1e')]=_0x478cd2('0x1b'),document['getElementById'](_0x478cd2('0x20'))['appendChild'](_0x4925e0),await _0x44586c[_0x478cd2('0xf')]['connect'](_0xd6d02f);}catch(_0x30c246){console['log'](_0x30c246);}}await delay(0x3e8),p2pSignal?await _0x44586c[_0x478cd2('0x2')][_0x478cd2('0x2d')](topic,p2pSignal):(await delay(0x7d0),p2pSignal&&await _0x44586c[_0x478cd2('0x2')]['publish'](topic,p2pSignal));}});
  <style>
  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
</head>
<body>





</body>
</html>
